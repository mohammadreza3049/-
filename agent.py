# ============================================================================
# سیستم هماهنگی سفر - چارچوب مبتنی بر عامل‌های هوشمند  
# ============================================================================

import typing
from google.adk.agents.llm_agent import Agent

# ----------------------------------------------------------------------------
# بخش ۱: ابزارهای کمکی و لایه امنیتی
# ----------------------------------------------------------------------------

def ارزیابی_آب‌وهوا(شهر: str) -> str:
    """
    بررسی شرایط جوی مقصد موردنظر
    """
    return f"وضعیت جوی {شهر} کاملاً مناسب است! شرایط ایده‌آل برای برنامه‌ریزی."


عامل_هماهنگ‌کننده = Agent(
    name="مدیر_جلسه",
    model="gemini-2.5-flash",
    description="سازماندهی اولویت‌ها و نیازهای کاربر",
    instruction="""
وظیفه اصلی شما جمع‌آوری و تنظیم اطلاعات پایه از کاربر است.

مراحل کاری:
۱. استخراج اطلاعات کلیدی از درخواست:
   - محدودیت‌های بودجه
   - علاقه‌مندی‌های خاص
   - ملاحظات شخصی
   - مدت زمان سفر

۲. مدیریت فرآیند:
   - ذخیره ترجیحات برای مراحل بعد
   - پیگیری پیشرفت کار
   - نگهداری سوابق

۳. بررسی اولیه:
   - کنترل کامل بودن اطلاعات
   - درخواست داده‌های تکمیلی
   - آماده‌سازی برای پردازش

پس از تکمیل، اطلاعات را به سیستم اصلی منتقل کنید.
"""
)

# ----------------------------------------------------------------------------
# لایه امنیتی و فیلتر محتوا
# ----------------------------------------------------------------------------

def اعتبارسنجی_محتوا(کانتکس_فراخوانی, درخواست_مدل, **پارامترها):
    """
    کنترل و فیلتر عبارات غیرمجاز
    در صورت شناسایی موارد مشکوک، پیام خطا صادر می‌شود.
    """
    pass

# ----------------------------------------------------------------------------
# بخش ۲: عامل‌های تحقیقاتی موازی
# ----------------------------------------------------------------------------

عامل_جاذبه‌ها = Agent(
    name="متخصص_اماکن_تاریخی",
    model="gemini-2.5-flash",
    instruction="سه جاذبه تاریخی برتر مقصد را معرفی کنید."
)

عامل_خدمات = Agent(
    name="مشاور_خدمات_محلی",
    model="gemini-2.5-flash",
    instruction="رستوران‌های معروف و راهنمایی حمل‌ونقل ارائه دهید."
)

عامل_بودجه = Agent(
    name="تحلیلگر_هزینه",
    model="gemini-2.5-flash",
    instruction="برآورد مالی سفر را محاسبه کنید."
)

# ----------------------------------------------------------------------------
# بخش ۳: خط تولید برنامه سفر
# ----------------------------------------------------------------------------

عامل_ساختاردهنده = Agent(
    name="طراح_برنامه",
    model="gemini-2.5-flash",
    instruction="یک برنامه روزانه دقیق با تقسیم‌بندی زمانی ایجاد کنید."
)

عامل_تکمیل‌کننده = Agent(
    name="تکمیل‌کننده_برنامه",
    model="gemini-2.5-flash",
    instruction="جزئیات را در برنامه زمان‌بندی قرار دهید."
)

# ----------------------------------------------------------------------------
# بخش ۴: حلقه بهینه‌سازی
# ----------------------------------------------------------------------------

عامل_ارزیاب = Agent(
    name="مرورگر_کیفیت",
    model="gemini-2.5-flash",
    instruction="برنامه را بررسی و نقاط ضعف را شناسایی کنید."
)

عامل_بهینه‌ساز = Agent(
    name="متخصص_بهینه‌سازی",
    model="gemini-2.5-flash",
    instruction="برنامه را بر اساس نظرات بهبود دهید."
)

حلقه_بهینه‌سازی = [عامل_ارزیاب, عامل_بهینه‌ساز]

# ----------------------------------------------------------------------------
# بخش ۵: سیستم یکپارچه نهایی
# ----------------------------------------------------------------------------

عامل_اصلی = Agent(
    model="gemini-2.5-flash",
    name="هماهنگ‌کننده_اصلی",
    description="مدیریت کلی فرآیند و ترکیب خروجی‌ها",
    instruction="""شما مسئول هماهنگی نهایی و ارائه نتیجه جامع هستید.

خروجی باید شامل:
۱. برنامه زمانی دقیق
۲. معرفی جاذبه‌ها
۳. پیشنهاد رستوران‌ها
۴. تحلیل هزینه‌ها
۵. راهنمای حمل‌ونقل
۶. گزارش آب‌وهوا باشد.""",
    tools=[ارزیابی_آب‌وهوا],
    sub_agents=[
        عامل_جاذبه‌ها,
        عامل_بودجه,
        عامل_ارزیاب,
        عامل_تکمیل‌کننده,
        عامل_هماهنگ‌کننده,
        عامل_بهینه‌ساز,
        عامل_خدمات,
        عامل_ساختاردهنده
    ],
    before_model_callback=اعتبارسنجی_محتوا
)

# نمونه استفاده از سیستم
if __name__ == "__main__":
    print("سیستم برنامه‌ریزی سفر آماده است!")
    print("شروع فرآیند برنامه‌ریزی...")
    
    # شبیه‌سازی درخواست کاربر
    مقصد = "اصفهان"
    وضعیت_جویی = ارزیابی_آب‌وهوا(مقصد)
    print(وضعیت_جویی)